<html>
<head>
  <title>mycat</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/606060 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="933"/>
<h1>mycat</h1>

<div>
<span><div>mycat需要依赖jdk</div><div><br/></div><div><br/></div><div>关闭防火墙</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>systemctl stop firewalld 关闭防火墙</div><div>systemctl disable firewalld 永久关闭防火墙</div><div>setenforce 0 临时关闭系统防火墙</div><div>vim /etc/selinux/config 编辑文件永久关闭系统防火墙</div><div>--- SELINUX=disabled</div></div><div><br/></div><div>下载mycat</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>wget http://dl.mycat.org.cn/1.6.7.1/Mycat-server-1.6.7.1-release-20190627191042-linux.tar.gz</div></div><div>解压</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>tar -zxf Mycat-server-1.6.7.1-release-20190627191042-linux.tar.gz</div></div><div>启动mycat</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>/root/mycat/bin/mycat start</div><div>/root/mycat/bin/mycat stop</div><div>/root/mycat/bin/mycat restart</div><div>/root/mycat/bin/mycat status</div></div><div><br/></div><div>访问mycat</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mysql -uroot -p123456 -h127.0.0.1 -P8066</div></div><div><br/></div><div>创建mycat代理账号</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mysql&gt; create user 'mycat'@'%' identified by 'test@A123456';  # 创建mycat访问账户</div><div>Query OK, 0 rows affected (0.00 sec)</div><div><br/></div><div><br/></div><div>mysql&gt; grant all on *.* to mycat;   # 授权mycat访问账号所有权限</div><div>Query OK, 0 rows affected (0.00 sec)</div></div><div><br/></div><div>配置端口和密码</div><div>修改mycat/conf/server.xml文件</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;!--修改mycat服务端口--&gt;</div><div>&lt;property name=&quot;serverPort&quot;&gt;8066&lt;/property&gt;  &lt;!-- mycat的连接端口 --&gt;  </div><div>&lt;user name=&quot;mycat&quot; defaultAccount=&quot;true&quot;&gt;   &lt;!-- 登录mycat用户名 --&gt;   </div><div>    &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt; &lt;!-- 登录mycat密码  --&gt;</div><div>    &lt;property name=&quot;schemas&quot;&gt;hello&lt;/property&gt;  &lt;!--虚拟数据库，建议跟后端真实数据库保持一致 --&gt;</div><div>     &lt;property name=&quot;defaultSchema&quot;&gt;hello&lt;/property&gt;  &lt;!-- 默认显示的虚拟数据库  --&gt;</div><div>&lt;/user&gt;</div></div><div><br/></div><div>配置读写分离</div><div>mycat/conf/schema.xml</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;?xml version=&quot;1.0&quot;?&gt;</div><div>&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;</div><div>&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;</div><div><br/></div><div>&lt;!-- 创建一个逻辑库 mycatproxy 自动追加逻辑库名  最大查询数100   数据节点名为dn1--&gt;</div><div>    &lt;schema name=&quot;hello&quot; checkSQLschema=&quot;false&quot; sqlMaxLimit=&quot;100&quot;&gt;</div><div>        &lt;table name=&quot;h_user&quot; dataNode=&quot;dn1&quot; /&gt;</div><div>        &lt;table name=&quot;t1&quot; dataNode=&quot;dn1&quot; /&gt;</div><div>        &lt;table name=&quot;t2&quot; dataNode=&quot;dn1&quot; /&gt;</div><div>        &lt;table name=&quot;t3&quot; dataNode=&quot;dn1&quot; /&gt;</div><div>    &lt;/schema&gt;</div><div>&lt;!-- 真实存在的数据库名 mycatproxy 此处的name=dn1必须与前面schema的dataNode值一致，否则mycat报错 --&gt;</div><div>    &lt;dataNode name=&quot;dn1&quot; dataHost=&quot;host1&quot; database=&quot;mycat&quot; /&gt;</div><div>    &lt;dataHost name=&quot;host1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;1&quot;</div><div>              writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;</div><div>        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</div><div>        &lt;!-- can have multi write hosts --&gt;</div><div>        &lt;!-- 后端Mycat连接的真实数据库 --&gt;</div><div>        &lt;!-- 写数据库配置 --&gt;</div><div>        &lt;writeHost host=&quot;hostM1&quot; url=&quot;192.168.48.176:3306&quot; user=&quot;mycat&quot; password=&quot;test@A123456&quot;&gt;</div><div>            &lt;!-- can have multi read hosts --&gt;</div><div>            &lt;readHost host=&quot;hostS2&quot; url=&quot;192.168.48.173:3306&quot; user=&quot;mycat&quot; password=&quot;test@A123456&quot; /&gt;</div><div>        &lt;/writeHost&gt;</div><div>    &lt;/dataHost&gt;</div><div>&lt;/mycat:schema&gt;</div></div><div><br/></div><div>登录mycat</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>mysql -uroot -p123456 -h192.168.48.176 -P8066</div></div><div><br/></div><div>mycat核心文件</div><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 130px;"></col><col style="width: 391px;"></col></colgroup><tbody><tr><td style="width: 130px; padding: 8px; border: 1px solid;"><div>配置文件</div></td><td style="width: 391px; padding: 8px; border: 1px solid;"><div>说明</div></td></tr><tr><td style="width: 130px; padding: 8px; border: 1px solid;"><div>server.xml</div></td><td style="width: 391px; padding: 8px; border: 1px solid;"><div>mycat的配置文件，设置账号、参数等</div></td></tr><tr><td style="width: 130px; padding: 8px; border: 1px solid;"><div>schema.xml</div></td><td style="width: 391px; padding: 8px; border: 1px solid;"><div>mycat对应的物理数据库和表的配置</div></td></tr><tr><td style="width: 130px; padding: 8px; border: 1px solid;"><div>rule.xml</div></td><td style="width: 391px; padding: 8px; border: 1px solid;"><div>mycat分片(分库分表)规则</div></td></tr></tbody></table><div>server.xml</div></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!-- - - Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</div><div>    - you may not use this file except in compliance with the License. - You</div><div>    may obtain a copy of the License at - - http://www.apache.org/licenses/LICENSE-2.0</div><div>    - - Unless required by applicable law or agreed to in writing, software -</div><div>    distributed under the License is distributed on an &quot;AS IS&quot; BASIS, - WITHOUT</div><div>    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. - See the</div><div>    License for the specific language governing permissions and - limitations</div><div>    under the License. --&gt;&lt;!DOCTYPE mycat:server SYSTEM &quot;server.dtd&quot;&gt;&lt;mycat:server xmlns:mycat=&quot;http://io.mycat/&quot;&gt;</div><div>    &lt;system&gt;</div><div>    &lt;!--配置的端口号--&gt;</div><div>    &lt;property name=&quot;serverPort&quot;&gt;8066&lt;/property&gt;</div><div>    &lt;property name=&quot;nonePasswordLogin&quot;&gt;0&lt;/property&gt; &lt;!-- 0为需要密码登陆、1为不需要密码登陆 ,默认为0，设置为1则需要指定默认账户--&gt;</div><div>    &lt;property name=&quot;useHandshakeV10&quot;&gt;1&lt;/property&gt;</div><div>    &lt;property name=&quot;useSqlStat&quot;&gt;0&lt;/property&gt;  &lt;!-- 1为开启实时统计、0为关闭 --&gt;</div><div>    &lt;property name=&quot;useGlobleTableCheck&quot;&gt;0&lt;/property&gt;  &lt;!-- 1为开启全加班一致性检测、0为关闭 --&gt;</div><div><br/></div><div>        &lt;property name=&quot;sequnceHandlerType&quot;&gt;2&lt;/property&gt;</div><div>    &lt;property name=&quot;subqueryRelationshipCheck&quot;&gt;false&lt;/property&gt; &lt;!-- 子查询中存在关联查询的情况下,检查关联字段中是否有分片字段 .默认 false --&gt;</div><div>      &lt;!--  &lt;property name=&quot;useCompression&quot;&gt;1&lt;/property&gt;--&gt; &lt;!--1为开启mysql压缩协议--&gt;</div><div>        &lt;!--  &lt;property name=&quot;fakeMySQLVersion&quot;&gt;5.6.20&lt;/property&gt;--&gt; &lt;!--设置模拟的MySQL版本号--&gt;</div><div>    &lt;!-- &lt;property name=&quot;processorBufferChunk&quot;&gt;40960&lt;/property&gt; --&gt;</div><div>    &lt;!--</div><div>    &lt;property name=&quot;processors&quot;&gt;1&lt;/property&gt;</div><div>    &lt;property name=&quot;processorExecutor&quot;&gt;32&lt;/property&gt;</div><div>     --&gt;</div><div>        &lt;!--默认为type 0: DirectByteBufferPool | type 1 ByteBufferArena | type 2 NettyBufferPool --&gt;</div><div>        &lt;property name=&quot;processorBufferPoolType&quot;&gt;0&lt;/property&gt;</div><div>        &lt;!--默认是65535 64K 用于sql解析时最大文本长度 --&gt;</div><div>        &lt;!--&lt;property name=&quot;maxStringLiteralLength&quot;&gt;65535&lt;/property&gt;--&gt;</div><div>        &lt;!--&lt;property name=&quot;sequnceHandlerType&quot;&gt;0&lt;/property&gt;--&gt;</div><div>        &lt;!--&lt;property name=&quot;backSocketNoDelay&quot;&gt;1&lt;/property&gt;--&gt;</div><div>        &lt;!--&lt;property name=&quot;frontSocketNoDelay&quot;&gt;1&lt;/property&gt;--&gt;</div><div>        &lt;!--&lt;property name=&quot;processorExecutor&quot;&gt;16&lt;/property&gt;--&gt;</div><div>        &lt;!--</div><div>            &lt;property name=&quot;serverPort&quot;&gt;8066&lt;/property&gt; &lt;property name=&quot;managerPort&quot;&gt;9066&lt;/property&gt;</div><div>            &lt;property name=&quot;idleTimeout&quot;&gt;300000&lt;/property&gt; &lt;property name=&quot;bindIp&quot;&gt;0.0.0.0&lt;/property&gt;</div><div>            &lt;property name=&quot;frontWriteQueueSize&quot;&gt;4096&lt;/property&gt; &lt;property name=&quot;processors&quot;&gt;32&lt;/property&gt; --&gt;</div><div>        &lt;!--分布式事务开关，0为不过滤分布式事务，1为过滤分布式事务（如果分布式事务内只涉及全局表，则不过滤），2为不过滤分布式事务,但是记录分布式事务日志--&gt;</div><div>        &lt;property name=&quot;handleDistributedTransactions&quot;&gt;0&lt;/property&gt;</div><div><br/></div><div>     &lt;!-- off heap for merge/order/group/limit  1开启   0关闭 --&gt;</div><div>        &lt;property name=&quot;useOffHeapForMerge&quot;&gt;1&lt;/property&gt;</div><div><br/></div><div>        &lt;!-- 单位为m--&gt;</div><div>        &lt;property name=&quot;memoryPageSize&quot;&gt;64k&lt;/property&gt;</div><div><br/></div><div>        &lt;!--单位为k--&gt;</div><div>        &lt;property name=&quot;spillsFileBufferSize&quot;&gt;1k&lt;/property&gt;</div><div>        &lt;property name=&quot;useStreamOutput&quot;&gt;0&lt;/property&gt;</div><div><br/></div><div>        &lt;!--  单位为m --&gt;</div><div>        &lt;property name=&quot;systemReserveMemorySize&quot;&gt;384m&lt;/property&gt;</div><div><br/></div><div>        &lt;!--是否采用zookeeper协调切换  --&gt;</div><div>        &lt;property name=&quot;useZKSwitch&quot;&gt;false&lt;/property&gt;</div><div><br/></div><div>        &lt;!-- XA Recovery Log日志路径 --&gt;</div><div>        &lt;!--&lt;property name=&quot;XARecoveryLogBaseDir&quot;&gt;./&lt;/property&gt;--&gt;</div><div><br/></div><div>        &lt;!-- XA Recovery Log日志名称 --&gt;</div><div>        &lt;!--&lt;property name=&quot;XARecoveryLogBaseName&quot;&gt;tmlog&lt;/property&gt;--&gt;</div><div><br/></div><div>        &lt;!--如果为 true的话 严格遵守隔离级别,不会在仅仅只有select语句的时候在事务中切换连接--&gt;</div><div>        &lt;property name=&quot;strictTxIsolation&quot;&gt;false&lt;/property&gt;</div><div>        &lt;property name=&quot;useZKSwitch&quot;&gt;true&lt;/property&gt;</div><div>    &lt;/system&gt;</div><div><br/></div><div>    &lt;!-- 全局SQL防火墙设置 --&gt;</div><div>    &lt;!--白名单可以使用通配符%或着*--&gt;</div><div>    &lt;!--例如&lt;host host=&quot;127.0.0.*&quot; user=&quot;root&quot;/&gt;--&gt;</div><div>    &lt;!--例如&lt;host host=&quot;127.0.*&quot; user=&quot;root&quot;/&gt;--&gt;</div><div>    &lt;!--例如&lt;host host=&quot;127.*&quot; user=&quot;root&quot;/&gt;--&gt;</div><div>    &lt;!--例如&lt;host host=&quot;1*7.*&quot; user=&quot;root&quot;/&gt;--&gt;</div><div>    &lt;!--这些配置情况下对于127.0.0.1都能以root账户登录--&gt;</div><div>    &lt;!-- 此处是开放了本机和外网的请求链接，因为我的mycat安装在虚拟机上，所以本机是通过ip链接</div><div>    192.*是为了让navicat可以连接使用(配置完整的虚拟机IP也可以)</div><div>    127.*是为了让虚拟机本身可以通过命令连接--&gt;</div><div>    &lt;firewall&gt;</div><div>       &lt;whitehost&gt;</div><div>          &lt;host host=&quot;192.*&quot; user=&quot;root&quot;/&gt;</div><div>          &lt;host host=&quot;127.*&quot; user=&quot;root&quot;/&gt;</div><div>       &lt;/whitehost&gt;</div><div>       &lt;blacklist check=&quot;false&quot;&gt;</div><div>       &lt;/blacklist&gt;</div><div>    &lt;/firewall&gt;</div><div><br/></div><div><br/></div><div>    &lt;!-- 此处定义了一个root用户，可以管理的逻辑库为mydatabase，对应schema.xml中的&lt;schema name=&quot;mydatabase&quot; &gt; --&gt;</div><div>    &lt;user name=&quot;root&quot; defaultAccount=&quot;true&quot;&gt;</div><div>        &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;</div><div>        &lt;property name=&quot;schemas&quot;&gt;mydatabase&lt;/property&gt;</div><div><br/></div><div>        &lt;!-- 表级 DML 权限设置 --&gt;</div><div>        &lt;!-- privileges 表示root用户的操作权限--&gt;</div><div>&lt;!-- dml 权限顺序为：insert(新增),update(修改),select(查询),delete(删除),0000–&gt; 1111,0 为禁止权限，1 为开启权限--&gt;</div><div>        &lt;!--        </div><div>        &lt;privileges check=&quot;false&quot;&gt;</div><div>            &lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;</div><div>                &lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;</div><div>                &lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;</div><div>            &lt;/schema&gt;</div><div>        &lt;/privileges&gt;       </div><div>         --&gt;</div><div>    &lt;/user&gt;</div><div><br/></div><div>    &lt;!--&lt;user name=&quot;user&quot;&gt;</div><div>        &lt;property name=&quot;password&quot;&gt;123456&lt;/property&gt;</div><div>        &lt;property name=&quot;schemas&quot;&gt;mycat1,test3&lt;/property&gt;</div><div>        &lt;property name=&quot;readOnly&quot;&gt;true&lt;/property&gt;</div><div>    &lt;/user&gt;--&gt;</div><div><br/></div><div>&lt;/mycat:server&gt;</div><div>system  标签中设置的是系统级别的相关参数，参考源文件中的注释即可能看懂，初始默认即可</div><div>user    标签是我们要注意的地方。MyCat 中的用户,用户可以访问的逻辑库,可以访问的逻辑表,服务的端口号等</div><div>说明：上面的默认的配置表示 创建的有两个用户root和user账号</div><div>root  账号,密码是123456，对应的逻辑库是 TESTDB</div><div>user  账号,密码是user,对应的逻辑库是 TESTDB,权限是`只读</div><div><br/></div></div><div><br/></div><div>schema.xml</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE mycat:schema SYSTEM &quot;schema.dtd&quot;&gt;&lt;mycat:schema xmlns:mycat=&quot;http://io.mycat/&quot;&gt;</div><div><br/></div><div>    &lt;!--</div><div>    name：为mycat逻辑库的名字，对应server&lt;property name=&quot;schemas&quot;&gt;mydatabase&lt;/property&gt;，</div><div>    建议设置跟数据库一样的名称</div><div>    checkSQLschema：自动检查逻辑库名称并拼接，true会在sql语句中的表名前拼接逻辑库名，</div><div>    例如select * from mydatabase.t_user;</div><div>    sqlMaxLimit：查询保护、如果没有写limit条件，会自动拼接。只查询100条。</div><div>    --&gt;</div><div>    &lt;schema name=&quot;mydatabase&quot; checkSQLschema=&quot;true&quot; sqlMaxLimit=&quot;100&quot;&gt;</div><div>        &lt;!--</div><div>        name:为物理数据库的表名，命名与物理数据库的一致</div><div>        dataNode:为dataNode标签(&lt;dataNode name=&quot;dn1&quot; dataHost=&quot;dtHost1&quot; database=&quot;db1&quot; /&gt;)里面的name值</div><div>        dataNode里面填写的节点数量必须和rule里面的规则数量一致</div><div>        例如rule里面只定义了两个0-1M=0  1M-2M=1那么此处只可以指定两个节点,1M=10000，M为单位万</div><div>        primaryKey:为表的ID字段，建议和rule.xml里面指定的ID和物理库的ID一致</div><div>        rule：分片规则，对应rule.xml中&lt;tableRule name=&quot;student_id&quot;&gt;的name</div><div>        type：表格类型，默认非global，用于全局表定义</div><div>        --&gt;</div><div>        &lt;table name=&quot;t_user&quot; dataNode=&quot;dn1,dn2,dn3&quot; primaryKey=&quot;id&quot; rule=&quot;auto-sharding-long&quot;&gt;</div><div>            &lt;!--ER分片注意childTable 标签需要放到table标签内，是主外键关联关系，</div><div>                name:为物理数据库的表名，命名与物理数据库的一致</div><div>                primaryKey:为表t_loginlog的ID字段，建议和rule.xml里面指定的ID和物理库的ID一致.</div><div>                joinKey：从表t_loginlog的外键字段，需要和物理库的字段名称一致</div><div>                parentKey：为主表t_user的字段名，依据此字段做关联，进行ER分片</div><div>            --&gt;     </div><div>            &lt;childTable name=&quot;t_loginlog&quot; primaryKey=&quot;id&quot; joinKey=&quot;user_id&quot; parentKey=&quot;id&quot;&gt;&lt;/childTable&gt;</div><div>        &lt;/table&gt;</div><div>        &lt;table name=&quot;t_student&quot; dataNode=&quot;dn1,dn3&quot; primaryKey=&quot;id&quot; rule=&quot;student_id&quot; /&gt;</div><div>        &lt;table name=&quot;t_dictionaries&quot; dataNode=&quot;dn1,dn2,dn3&quot; type=&quot;global&quot; /&gt;</div><div>        &lt;table name=&quot;t_teacher&quot; dataNode=&quot;dn1&quot; /&gt;</div><div>    &lt;/schema&gt;</div><div><br/></div><div><br/></div><div>        &lt;!-- name：节点名称，用于在table标签里面调用</div><div>        dataHost:dataHost标签name值(&lt;dataHost name=&quot;dtHost1&quot;&gt;)</div><div>        database:物理数据库名，需要提前创建好实际存在的--&gt;</div><div>        &lt;dataNode name=&quot;dn1&quot; dataHost=&quot;dtHost1&quot; database=&quot;db1&quot; /&gt;</div><div>        &lt;dataNode name=&quot;dn2&quot; dataHost=&quot;dtHost1&quot; database=&quot;db2&quot; /&gt;</div><div>        &lt;dataNode name=&quot;dn3&quot; dataHost=&quot;dtHost2&quot; database=&quot;db3&quot; /&gt;</div><div><br/></div><div><br/></div><div>    &lt;!--</div><div>    name：节点名称，在上方dataNode标签中调用</div><div>    maxCon:底层数据库的链接最大数</div><div>    minCon:底层数据库的链接最小数</div><div>    balance:值可以为0,1,2,3,分别表示对当前datahost中维护的数据库们的读操作逻辑</div><div>    0:不开启读写分离，所有的读写操作都在最小的索引号的writeHost(第一个writeHost标签)</div><div>    1：全部的readHost和备用writeHost都参与读数据的平衡，如果读的请求过多，负责写的第一个writeHost也分担一部分</div><div>    2 ：所有的读操作，都随机的在所有的writeHost和readHost中进行</div><div>    3 ：所有的读操作，都到writeHost对应的readHost上进行（备用writeHost不参加了）,在集群中没有配置ReadHost的情况下,读都到第</div><div>    一个writeHost完成</div><div>    writeType:控制当前datahost维护的数据库集群的写操作</div><div>    0：所有的写操作都在第一个writeHost标签的数据库进行</div><div>    1：所有的写操作，都随机分配到所有的writeHost（mycat1.5完全不建议配置了）</div><div>    dbtype：数据库类型（不同数据库配置不同名称，mysql）</div><div>    dbDriver:数据库驱动，native,动态获取</div><div>    switchType：切换的逻辑</div><div>    -1：故障不切换</div><div>    1：故障切换，当前写操作的writeHost故障，进行切换，切换到下一个writeHost；</div><div>    slaveThreshold：标签中的&lt;heartbeat&gt;用来检测后端数据库的心跳sql语句;本属性检查从节点与主节点的同步情况(延迟时间数),配合心</div><div>    跳语句show slave status; 读写分离时,所有的readHost的数据都可靠</div><div>    --&gt;</div><div>    &lt;dataHost name=&quot;dtHost1&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;1&quot;</div><div>              writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;</div><div>        &lt;!--用于验证心跳，这个是mysql主库的配置--&gt;</div><div>        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</div><div><br/></div><div><br/></div><div>        &lt;writeHost host=&quot;127.0.0.1&quot; url=&quot;192.168.199.11:3306&quot; user=&quot;root&quot; password=&quot;123456&quot;&gt;</div><div>            &lt;readHost host=&quot;127.0.0.1&quot; url=&quot;192.168.199.12:3306&quot; user=&quot;root&quot; password=&quot;123456&quot; /&gt;</div><div>        &lt;/writeHost&gt;</div><div><br/></div><div><br/></div><div>    &lt;/dataHost&gt;</div><div>    &lt;dataHost name=&quot;dtHost2&quot; maxCon=&quot;1000&quot; minCon=&quot;10&quot; balance=&quot;1&quot;</div><div>              writeType=&quot;0&quot; dbType=&quot;mysql&quot; dbDriver=&quot;native&quot; switchType=&quot;1&quot;  slaveThreshold=&quot;100&quot;&gt;</div><div>        &lt;!--用于验证心跳，这个是mysql主库的配置--&gt;</div><div>        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;</div><div><br/></div><div><br/></div><div>        &lt;writeHost host=&quot;127.0.0.1&quot; url=&quot;192.168.199.13:3306&quot; user=&quot;root&quot; password=&quot;123456&quot;&gt;</div><div>            &lt;readHost host=&quot;127.0.0.1&quot; url=&quot;192.168.199.13:3306&quot; user=&quot;root&quot; password=&quot;123456&quot; /&gt;</div><div>        &lt;/writeHost&gt;</div><div><br/></div><div>    &lt;/dataHost&gt;</div><div>&lt;/mycat:schema&gt;</div></div><div><br/></div><div>节点描述</div><div><div><br/></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 82px;"></col><col style="width: 127px;"></col><col style="width: 127px;"></col><col style="width: 127px;"></col><col style="width: 323px;"></col><col style="width: 169px;"></col></colgroup><tbody><tr><td style="width: 82px; padding: 8px; border: 1px solid;"><div>节点</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>属性</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>子标签</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>子标签描述</div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>属性描述</div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div>节点描述</div></td></tr><tr><td rowspan="8" style="height: 272px; width: 82px; padding: 8px; border: 1px solid;"><div>schema</div></td><td colspan="4" style="width: 704px; padding: 8px; border: 1px solid;"><div><br/></div></td><td rowspan="8" style="height: 272px; width: 169px; padding: 8px; border: 1px solid;"><div>配置逻辑库,name与server.xml中schema对应</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>name</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>逻辑库名称</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>checkSQLschema</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>是否检测 SQL 语法中的 schema 信息. 如: MyCat逻辑库名称 A, dataNode 名称 B </div><div>SQL : select * from A.table; </div><div>checkSQLschema 值是 true, MyCat发送到数据库的 SQL 是 select * from table; </div><div>checkSQLschema 只是 false,MyCat发送的数据库的 SQL 是 select * from A.table;</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>sqlMaxLimit</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>MyCat 在执行 SQL 的时候,如果 SQL 语句中没有 limit 子句.自动增加 limit 子句. 避免一次 性得到过多的数据,影响效率. limit子句的限制数量默认配置为100.如果 SQL中有具体的 limit 子句,当前属性失效. </div><div>SQL : select * from table . MyCat解析后: select * from table limit 100 </div><div>SQL : select * from table limit 10 . MyCat 不做任何操作修改.</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>table</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>定义逻辑表的标签</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>name</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>逻辑表名</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>dataNode</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>数据节点名称. 即物理数据库中的 database 名称.多个名称使用逗号分隔.</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>rule</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>分片规则名称，具体参照rule.xml</div></td></tr><tr><td rowspan="4" style="height: 128px; width: 82px; padding: 8px; border: 1px solid;"><div>dataNode</div></td><td colspan="4" style="width: 704px; padding: 8px; border: 1px solid;"><div><br/></div></td><td rowspan="4" style="height: 128px; width: 169px; padding: 8px; border: 1px solid;"><div>定义数据节点的标签，也就是分库的相关配置</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>name</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>数据节点名称, 是定义的逻辑名称,对应具体的物理数据库 database</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>dataHost</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>引用 dataHost 标签的 name 值,代表使用的物理数据库所在位置和配置信息.</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>database</div></td><td colspan="2" style="border: 1px solid; width: 254px; padding: 8px;"><div><br/></div><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>在 dataHost 物理机中,具体的物理数据库 database 名称.</div></td></tr><tr><td rowspan="15" style="height: 524px; width: 82px; padding: 8px; border: 1px solid;"><div>dataHost</div></td><td colspan="4" style="width: 704px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div>物理数据库，真正存储数据的数据库</div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>name</div></td><td colspan="2" style="width: 254px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>定义逻辑上的数据主机名称</div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>maxCon/minCon</div></td><td colspan="2" style="width: 254px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>最大连接数, max connections </div><div>最小连接数, min connections</div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>dbType</div></td><td colspan="2" style="width: 254px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>数据库类型 : mysql 数据库</div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>dbDriver</div></td><td colspan="2" style="width: 254px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div>数据库驱动类型, native,使用 MyCat提供的本地驱动.</div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td rowspan="5" style="height: 164px; border: 1px solid; width: 127px; padding: 8px;"><div><span style="color: rgb(18, 18, 18); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">dataHost </span> <span style="color: rgb(18, 18, 18); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">子标签 writeHost</span></div></td><td colspan="2" style="width: 254px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>host</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>数据库命名</div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>url</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>数据库访问路径</div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>user</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>数据库访问用户名</div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>password</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>数据库访问密码</div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td rowspan="5" style="height: 164px; border: 1px solid; width: 127px; padding: 8px;"><div><span style="color: rgb(18, 18, 18); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">writeHost 子标签 readHost</span></div></td><td colspan="2" style="width: 254px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>host</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>数据库命名</div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>url</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>数据库访问路径</div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>user</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>数据库访问用户名</div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr><tr><td style="border: 1px solid; width: 127px; padding: 8px;"><div>password</div></td><td style="width: 127px; padding: 8px; border: 1px solid;"><div>数据库访问密码</div></td><td style="width: 323px; padding: 8px; border: 1px solid;"><div><br/></div></td><td style="width: 169px; padding: 8px; border: 1px solid;"><div><br/></div></td></tr></tbody></table><div><br/></div></div><div><br/></div></span>
</div></body></html> 